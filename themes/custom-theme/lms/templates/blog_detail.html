<%page expression_filter="h"/>
<%!
from django.urls import reverse
from django.utils.translation import ugettext as _
from branding import api as branding_api
%>
<%inherit file="main.html" />
<%namespace name='static' file='static_content.html'/>

<%block name="pagetitle">${_("Blog")}</%block>
## <script src="https://cdn.tiny.cloud/1/bx236jwgk2th37ph2n7ky578lqji067s4dkl9mvqim4hew77/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style>
    body {
        font-family: "Roboto", sans-serif;
        font-size: 18px !important;
        background-color: #fdfdfd;
    }
    
    .head_text {
        color: white;
    }
    
    .card {
        box-shadow: 0 16px 48px #E3E7EB;
    }
.notify{
	top:10.5em;
}
#item-count{
	top: -24px;
}
.btn-default{

	color:unset;
}
button{
	color:unset;
	background-image:unset;
	box-shadow: none;
}
button:hover:not(:disabled), .btn-default:hover{
	background-color: unset;
	background-image:unset;
	color: unset;
}
input[type="submit"] {
	background-image:none;
	text-shadow:none;
}
input[type="submit"]:hover {
	background-image:none !important;
	text-shadow:none !important;
	border:none !important;
	background-color: #e4c481 !important;
	color: black !important;
}
</style>
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.16/dist/summernote.min.css" rel="stylesheet">
% if user.is_staff:
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.16/dist/summernote.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	/*tinymce.init({
  		selector: 'textarea#tm',
  		menubar: 'none'
	});*/
	$('#tm').summernote({
  		toolbar: [
    		// [groupName, [list of button]]
    		['style', ['bold', 'italic', 'underline', 'clear']],
    		['font', ['strikethrough', 'superscript', 'subscript']],
    		['fontsize', ['fontsize']],
    		['color', ['color']],
    		['para', ['ul', 'ol', 'paragraph']],
    		['height', ['height']]
  		]
	});
	$('input[type="submit"]').click(function(e){
		$.ajax({
   		url: "${reverse('blog')}",			// URL
		method: "POST",                          
   		data: $('#post_form').serialize(),              // Serialize the form data
   		success: function (data) {     			// If 200 OK             
      			window.location = "${reverse('blog')}?slug="+data.slug;
   		},
   		error: function (xhr, text, error) {            // If 40x or 50x; errors
      			alert('Error: ' + error);
   		}
		});
		e.preventDefault();
	});

	$("#edit_post").click(function(e){
		$('#form_container').show();
		$('#post_container').hide();
		$('#edit_post').hide();
		$('#cancel').show();
		e.preventDefault();
	});

	$("#delete_post").click(function(e){
		$.ajax({
      			url: "${reverse('blog')}?slug=${ post['slug'] }",
      			method: "DELETE", // use "GET" if server does not handle DELETE
    		}).done(function( msg ) {
      			window.location="${reverse('blog')}";
    		}).fail(function( jqXHR, textStatus ) {
     			alert( "Request failed: " + textStatus );
    		}); 
		e.preventDefault();
	});

	$("#cancel").click(function(e){
		$('#form_container').hide();
		$('#post_container').show();
		$('#edit_post').show();
		$('#cancel').hide();
		e.preventDefault();
	});

});
</script>
% endif
<main id="main" aria-label="Content" tabindex="-1">
    <section class="container about">
 <header class="masthead">
    <div class="overlay"></div>
    <div class="container" style="background:#6a1b1a;">
        <div class="row">
            <div class=" col-md-8 col-md-10 mx-auto">
                <div class="site-heading">
                    <h3 class=" site-heading my-3 mt-3 text-white" style="font-size:22px;"> ${ post['title'] } </h3>
                    <!--<p class="text-light">by ${ post['author'] } &nbsp</p>-->
                </div>
            </div>
        </div>
    </div>
</header>
% if user.is_staff:
<br>
<a id="edit_post" class="btn btn-primary" href="#!">Edit post</a>
<a id="cancel" class="btn btn-danger" href="#!" style="display:none;">Cancel</a>
<a id="delete_post" class="btn btn-danger" href="#!">Delete post</a>
<br>
<div id="form_container" class="container"  style="display:none;">
  <div class="row">
    <div class="col-md-10">
 	<form id="post_form" method="post" role="form">
        <div class="form-group">
		Title :
        	<input type="text" class="form-control" style="font-size: large;font-style: normal;font-family: Roboto;" name="title" placeholder="Blog Title" value="${ post['title'] }"/>
        </div>
        <div class="form-group">
        	<textarea id="tm" class="form-control" name="content" val>${ post['content'] | n }</textarea>
        </div>
		<input name="edit" type="hidden" value="true"/>
		<input name="slug" type="hidden" value="${ post['slug'] }"/>
        <div class="form-group">
        	<input type="submit" name="Submit" value="Save" class="btn btn-primary form-control" />
        </div>
 	</form>
        </div>
    </div>
</div>
<br>
% endif   
 <div id="post_container" class="container">
  <div class="row">
    <div class="col-md-12 card mb-4  mt-3 left  top">
      <div class="card-body">
        <p class=" text-muted">${ post['author'] } | ${ post['created'] }</p>
        <p class="card-text ">${ post['content'] | n }</p>
      </div>
    </div>
  </div>
</div>
    
    </section>
</main>

